@using PetitesPuces.Models
@using PetitesPuces.Utilities
@model PetitesPuces.Models.Panier

@{
    ViewBag.SousTotal = @Model.Articles.Sum(a => a.PPProduit.PrixVente * a.NbItems);
    ViewBag.FraisLivraison = (decimal)23.00;
}
<div class="row">
    <div class="col-md-8" style="height: 70vh;
                                      overflow: auto;">
        <table class="table table-hover">
            <tbody>
            @foreach(PPArticlesEnPanier article in @Model.Articles)
            {
                @Html.Partial("Client/_ProduitsPanier", article)
            }
            </tbody>
        </table>
    </div>
    <div class="col-md-4">
        <button type="button" data-toggle="modal" data-target="#modalConfirmationSupprimer" class="btn btn-danger">Supprimer ce panier</button>
        <br/>
        <br/>
        <div class="panel panel-primary">
            <div class="panel-heading">Récapitulaif: </div>
            <div class="panel-body">
                <div class="h4">
                    <p class="row">
                        <div class="col-xs-8">Nombre d'items :</div>
                        <div class="col-xs-4" style="text-align: right">@Model.Articles.Sum(a=>a.NbItems)</div></p>
                    
                    <p class="row">
                        <div class="col-xs-8">Sous total :</div>
                        <div class="col-xs-4">@Formatter.Money(@Model.Articles.Sum(a=>a.NbItems*a.PPProduit.PrixVente))</div></p>
                    <div class="row">
                        <br/><hr/>
                    </div>

                </div>

                
                <button type="button" class="btn btn-primary" data-toggle="modal" data-target="#confirmationCommande">
                    Passer la commande
                </button>
            </div>
        </div>
        <div class="panel panel-success">
            <div class="panel-heading">Informations sur le vendeur: </div>
            <div class="panel-body">
                <div class="h4">
                    <p><a href="@Url.Action("Catalogue", "Client", new RouteValueDictionary(new { Vendeur= @ViewBag.Vendeur }))">@Model.Vendeur.NomAffaires</a></p>
                    <p>Membre depuis @Model.Vendeur.DateCreation.ToString()</p>

                    <hr/>

                    <p>Nombres de ventes : @Model.Vendeur.PPCommandes.Count</p>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Modal pour supprimer panier -->
<div class="modal fade" id="modalConfirmationSupprimer" tabindex="-1" role="dialog" aria-labelledby="modalConfirmationSupprimer" aria-hidden="true">
    <div class="modal-dialog" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="exampleModalLabel">Confirmation</h5>
                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                </button>
            </div>
            <div class="modal-body">
                Êtes-vous sûr de vouloir supprimer ce panier?
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-dismiss="modal">Annuler</button>
                <button type="button" type="button" onclick="supprimerPanier(@Model.Vendeur.NoVendeur)" class="btn btn-primary">Supprimer</button>
            </div>
        </div>
    </div>
</div>


<!-- Modal confirmation -->
<div class="modal fade" id="confirmationCommande" tabindex="-1" role="dialog" aria-labelledby="confirmationCommande" aria-hidden="true">
    <div class="modal-dialog" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                </button>
                <h5 class="modal-title" id="exampleModalLabel">Confirmation</h5>
            </div>
            <div class="modal-body">
                <p>Êtes-vous sûr de vouloir commander ces articles?</p>
                <br/><p>Vous aurez la chance d'annuler la commande passé ce point.</p>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-dismiss="modal">Annuler</button>
                <button type="button" onclick="location.href = '@Url.Action("Commande", "Client",new RouteValueDictionary(new { Etape= "Information", noVendeur = Model.Vendeur.NoVendeur }))'" class="btn btn-primary">Continuer</button>
            </div>
        </div>
    </div>
</div>

<script>
    window.addEventListener("load",function(){
        $('#Panier'+@Model.Vendeur.NoVendeur).first().addClass("Current");
    },false);
</script>